<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Monalisa SJB - Google Charts + DataTable</title>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
  <h2>Google Charts - Pie Chart</h2>
  <div id="piechart"></div>
  <button id="exportPie">Download Pie as PNG</button>

  <h2>Google Charts - Line Chart</h2>
  <div id="linechart"></div>
  <button id="exportLine">Download Line as PNG</button>

  <h2>Google DataTable</h2>
  <div id="datatable"></div>

  <script>
    google.charts.load('current', {'packages':['corechart', 'table']});
    google.charts.setOnLoadCallback(drawCharts);

    function drawCharts() {
      fetch('data/data.json')
        .then(response => response.json())
        .then(data => {
          const chartData = [['KPKNL', 'Jumlah']].concat(data.map(d => [d.kpknl, d.jumlah]));

          var pieData = google.visualization.arrayToDataTable(chartData);
          var lineData = google.visualization.arrayToDataTable(chartData);

          var pieChart = new google.visualization.PieChart(document.getElementById('piechart'));
          var lineChart = new google.visualization.LineChart(document.getElementById('linechart'));

          pieChart.draw(pieData, { title: 'Pie Chart' });
          lineChart.draw(lineData, { title: 'Line Chart' });

          // DataTable
          var tableData = new google.visualization.DataTable();
          tableData.addColumn('string', 'KPKNL');
          tableData.addColumn('number', 'Jumlah');
          data.forEach(d => tableData.addRow([d.kpknl, d.jumlah]));

          var table = new google.visualization.Table(document.getElementById('datatable'));
          table.draw(tableData, { showRowNumber: true, width: '50%' });

          // Export PNG
          document.getElementById('exportPie').onclick = () => {
            var uri = pieChart.getImageURI();
            downloadURI(uri, 'piechart.png');
          };

          document.getElementById('exportLine').onclick = () => {
            var uri = lineChart.getImageURI();
            downloadURI(uri, 'linechart.png');
          };

          function downloadURI(uri, name) {
            var link = document.createElement("a");
            link.download = name;
            link.href = uri;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          }

        });
    }
  </script>
</body>
</html>
